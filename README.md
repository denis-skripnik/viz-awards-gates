# viz-awards-gates
NPM пакет для приложений, награждающих пользователей различных сервисов/
## Установка:
1. В папке вашего nodejs приложения выполняете команду:
npm install viz-awards-gates
2. После завершения инстолляции идёте в node_modules/viz-awards-gates и изменяете файл config.json: там надо заполнить название сервиса (по умолчанию youtube; можно и домен сайта, например, myforum.ru), а также логин с активным ключом аккаунта шлюза.
3. Сохранив файл, подключаете в коде своего приложения. Пример:
```
const vag = require('viz-awards-gates');
async function noReturn() {
await vag.getAwards();
}
noReturn();
async function getViz(user, viz_acc, amount) {
if (user === true) { // проверяем, что в приложении авторизовался именно тот пользователь сервиса, кого награждали.
await wag.addVizAccount(user, viz_acc); // Добавляем в базу Viz аккаунт.
await vag.withdraw(user, amount); // выводим ему токены.
}
}
```
Учитывайте, что проверка должна быть на стороне вашего приложения: в пакет данный функционал не был добавлен, т.к. он отличается от сервиса к сервису.
4. Даёте инструкцию пользователю шлюза или внедряете в интерфейс награду. memo имеет вид: "сервис:логин" (без кавычек), например, youtube:scadens или myforum.ru:login@mail.ru

## Функционал:
1. Получение наград аккаунту шлюза из БЧ. и фильтрация их по memo, чтоб заметка соответствовала вашему сервису.
2. Прибавление или создание баланса в базе данных. Создание баланса = добавление нового логина в БД.
Под логином понимается то, что идентифицирует пользователя: id, email, логин, первый ключ и пр.
При прибавлении баланса происходит увеличение суммы в базе данных для конкретного логина.
3. Добавление Viz аккаунта.
4. Вывод: специальная функция (см. пример подключения), которая отправляет с аккаунта шлюза на аккаунт пользователя в Viz накопленного баланса. При этом, можно указать конкретную сумму, а не только вывести всё. 
При желании приложение ваше может сделать автоматический вывод всей суммы раз в определённое время.
5. Есть две базы данных: с последним блоком и со списком пользователей сервиса. Во второй указываются логины и их балансы;
С ними при желании можно работать.

## Функции:
Экспортированы getAwards, addVizAccount, withdraw и search.
1. getAwards - не требует аргументов.
2. addVizAccount(user, viz_login) - функция добавления Viz аккаунта в базу данных пользователя. Принимает аргументы: логин в БД., логин в Viz.
Возвращает json, содержащий либо 1 (всё ок), либо 0 (аккаунта в базе нет), либо -1 (ошибка). Также есть message, если 1 или error, если 0 или -1: там текст.
3. withdraw: логин в сервисе (тот, что есть в базе данных) и сумма в SHARES без указания " SHARES".
Пример: 
ag.withdraw('scadens', 3.168929).
Сумма SHARES не должна быть больше имеющейся у пользователя в базе данных.
Должен быть в базе логин Viz.
Возвращает json. Он состоит из code (1, если успех; 0, если аккаунта в базе нет; -1, если иная ошибка).
4. withdrawShares (не требует вызова в приложении, без аргументов).
5. search (поиск пользователя в базе): единственный аргумент - логин пользователя.
Пример:
await vag.search('scadens');

## Что делает приложение, использующее пакет viz-awards-gates:
1. Отправляет уведомлений о награждении. В начале думал сделать в пакете, но после понял, что это ни к чему, т.к. текст у каждого будет свой;
2. Само определяет подлинность авторизовавшегося пользователя: через oAuth, путём отправки custom_json или memo (блокчейны), как-то ещё.

## Проведены тесты:
Всё ок.

## Контакты:
Автор - Денис Скрипник.
Telegram: https://t.me/skripnikdenis
Viz аккаунт: https://viz.world/@denis-skripnik/